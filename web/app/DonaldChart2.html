<!DOCTYPE html>
<meta charset='utf-8'>
<style>
    body {
        font: 10px sans-serif;
    }

    .axis path,
    .axis line {
        fill: none;
        stroke: #000;
        shape-rendering: crispEdges;
    }

    .bar.positive {
        fill: steelblue;
    }
    .bar.negative {
        fill: #bc211a;
    }
    .bar.neutral {
        fill: #e0b83d;
    }
    .bar.neutral:hover {
        fill: #f4db16;
    }
    .bar.negative:hover {
        fill: #f23f21;
    }
    .bar.positive:hover {
        fill: #6fbdf2;
    }

    .x.axis path {
        display: none;
    }

    .d3-tip {
        line-height: 1;
        font-weight: normal;
        padding: 12px;
        background: rgba(0, 0, 0, 0.6);
        color: #fff;
        border-radius: 2px;
    }

    /* Creates a small triangle extender for the tooltip */
    .d3-tip:after {
        box-sizing: border-box;
        display: inline;
        font-size: 10px;
        width: 100%;
        line-height: 1;
        color: rgba(0, 0, 0, 0.6);
        content: '\25BC';
        position: absolute;
        text-align: center;
    }

    /* Style northward tooltips differently */
    .d3-tip.n:after {
        margin: -1px 0 0 0;
        top: 100%;
        left: 0;
    }
</style>
<link type="css" src="https://raw.githubusercontent.com/daneden/animate.css/master/animate.min.css">
<body>
<script src='http://d3js.org/d3.v3.min.js'></script>
<script src='http://labratrevenge.com/d3-tip/javascripts/d3.tip.v0.6.3.js'></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script>

    var margin = {top: 85, right: 40, bottom: 25, left: 40},
        width = Math.max(document.documentElement.clientWidth, window.innerWidth || 0)
                - margin.left - margin.right,
        height = Math.max(document.documentElement.clientHeight, window.innerHeight || 0)
                - margin.top - margin.bottom;

    var tip = d3.tip()
        .attr('class', 'd3-tip')
        .offset([-10, 0])
            .html(function(d) {
                var cache = [];
                return '<strong>Data:</strong> <span style="color:#E9F2F9">'
//                    + JSON.stringify(d,
//                        function(key, score) {
//                            if (typeof score === 'object' && score !== null) {
//                                if (cache.indexOf(score) !== -1) {
//                                    // Circular reference found, discard key
//                                    return;
//                                }
//                                // Store score in our collection
//                                cache.push(score);
//                            }
//                            return score;
//                        });
//                cache = [];
                + ' count: ' + d.count + ' score: ' + d.score
                + '</span>';
        });
    var zoom = d3.behavior.zoom();
    var active = d3.select(null);
    var svg = d3.select('body').append('svg')
        .attr('width', width + margin.left + margin.right)
        .attr('height', height + margin.top + margin.bottom)
        .append('g')
//        .call(zoom.on("zoom", redraw))
        .attr('transform', 'translate(' + margin.left + ',' + margin.top + ')');
    var JsonData;


    function redraw() {
        var translation = d3.event.translate,
            newx = translation[0],
            newy = translation[1];
        console.log("translate: ", zoom.translate(), "scale:", zoom.scale());
        svg.attr("transform",
                "translate(" + newx + "," + newy + ")"
                + " scale(" + zoom.scale() + ")");
    }

    function manualZoom(){
        var translation = zoom.translate,
            newx = translation[0],
            newy = translation[1];
        svg.attr("transform",
            "translate(" + newx + "," + newy + ")"
            + " scale(" + zoom.scale() + ")");
    }

    svg.call(tip);


    // x-axis
    var xScale = d3.scale.linear()
            .domain([-100, 100]) // these are value mappings
            .range([0, width]); // these are pixels
    // y-axis
    var yScale;

    d3.json('DonaldData.json', function(error, data){
        if(error){
            console.err('DonaldData.json Error: ' + error);
            return;
        }
        JsonData = data;
        var xAxis = d3.svg.axis()
            .scale(xScale)
            .orient('bottom');

        yScale = d3.scale.linear()
            .domain([0, d3.max(data, function(d) { return d.count; })])
            .range([height, 0]);

        //Define Y axis
        var yAxis = d3.svg.axis()
            .scale(yScale)
            .orient('left');

        // X Axis drawing
        svg.append('g')
            .attr('class', 'x axis')
            .attr('transform', 'translate(0,' + height + ')')
            .attr('y', 6)
            .attr('dy', '.71em')
            .style('text-anchor', 'end')
            .text('Score')
            .call(xAxis);

        // Y Axis drawing
        svg.append('g')
            .attr('class', 'y axis')
            .call(yAxis)
            .append('text')
            .attr('transform', 'rotate(-90)')
            .attr('y', 6)
            .attr('dy', '.71em')
            .style('text-anchor', 'end')
            .text('Count');

        // Data Bar
        svg.selectAll('.bar')
            .data(data)
            .enter().append('rect')
            .attr('class', 'bar')
            .attr('class', function(d) {
                if(d.score < -15){
                    return 'bar negative';
                }
                else if(d.score < 15){
                    return 'bar neutral';
                }
                else {
                    return 'bar positive';
                }
            })
            .attr('x', function(d) { return xScale(d.score) - 7; })
            .attr('width', 14)
            .attr('y', function(d) { return yScale(d.count); })
            .attr('height', function(d) { return height - yScale(d.count); })
            .on('click', showSentences())
            .on('mouseover', tip.show)
            .on('mouseout', tip.hide);
    });

//    var timer;
//    function clicked(d) {
//        if (active.node() === this) {
//            console.log('active: ' + active.node());
//            return reset();
//        }
//        active.classed("active", false);
//        active = d3.select(this).classed("active", true);
//
////        var bounds = path.bounds(d),
////                dx = bounds[1][0] - bounds[0][0],
////                dy = bounds[1][1] - bounds[0][1],
////                x = (bounds[0][0] + bounds[1][0]) / 2,
////                y = (bounds[0][1] + bounds[1][1]) / 2,
////                scale = .9 / Math.max(dx / width, dy / height),
////                translate = [width / 2 - scale * x, height / 2 - scale * y];
//        svg.transition()
//            .duration(750)
//            .call(zoom.translate([0, 0]).scale(1).event);
//    }
//
//    function reset() {
//
//        active.classed("active", false);
//
//        active = d3.select(null);
//
//        svg.transition()
//            .duration(750)
//            .call(zoom.translate([0, 0]).scale(1).event);
//        console.log('reset3');
//    }
//
//    function zoomed() {
//        g.style("stroke-width", 1.5 / d3.event.scale + "px");
//        g.attr("transform", "translate(" + d3.event.translate + ")scale(" + d3.event.scale + ")");
//    }
//
//    // If the drag behavior prevents the default click,
//    // also stop propagation so we donâ€™t click-to-zoom.
//    function stopped() {
//        if (d3.event.defaultPrevented) d3.event.stopPropagation();
//    }
    $(document).on("click",".bar", function () {
        console.log('hello');
        $(this).css('fill', '#A0C55F');
        console.log('hello2');
    });
</script>
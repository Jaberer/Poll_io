<html lang="en">
<head>
    <title>
        Poll.io
    </title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="description" content="Poll for cool info from all your friends and peers with poll.io!">

    <link rel="stylesheet" href="stylesheets/d3.css">
    <link rel="stylesheet" href="stylesheets/example.css">
    <link rel="stylesheet" href="stylesheets/normalize.css">
    <link rel="stylesheet" href="stylesheets/fonts.css">
    <link rel="ico" href="assets/favicon.ico">
    <style type='text/css'>.tk-proxima-nova-soft{font-family:"proxima-nova-soft",sans-serif;}.tk-futura-pt{font-family:"futura-pt",sans-serif;}</style><link rel="stylesheet" href="https://use.typekit.net/c/39f9de/1w;futura-pt,2,SH9:V:i4,SH6:V:i7,Y5K:V:n4,SH5:V:n7;proxima-nova-soft,7cdcb44be4a7db8877ffa5c0007b8dd865b3bbc383831fe2ea177f62257a9191,gDX:V:n4,gDY:V:n5,gDZ:V:n6,gDb:V:n7/l?3bb2a6e53c9684ffdc9a9bff1f5b2a626519ae8d4e1a1ed3b663be3f1c1e3679a656331ad78951701a441785ad027f951a763942296e5a8dc89a8cbd5a30c0591ff7b96eec14db5802462a6398435346e2f48933193bff4e6466334e1129183cdb6d7981123c06d71b0f22ab164871ccebe55ea7fb934f67b2cfee4b76801beddce67b271b196ca1971a4f9614953a36bce0f70e86b4be979b2cbac782bc0cdacf9291be7a408fc73ccc2f3218f0512adb4a49ea5fc7c98b7836e7f0f3952548d2d9c8" media="all"><script>try{Typekit.load();}catch(e){}</script>
    <script src='https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js'></script>
    <script src='http://d3js.org/d3.v3.min.js'></script>
    <script src='http://labratrevenge.com/d3-tip/javascripts/d3.tip.v0.6.3.js'></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
</head>

<body>
    <div id="wrapper" class="home">
        <div class="home-page">
        <div class="container">
            <div class="row">
                <div class="col-md-6 home-image visible-xs">
                </div>
                <div class="col-md-6">
                    <div class="row">
                        <div class="col-md-12">
                            <div class="home-slogan">
                                Get a live feed of what
                                <br>everyone's saying around you.
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-xs-12">
                            <div class="row">
                                <form class="form home-form" role="form">
                                    <div class="col-md-7">
                                        <div class="form-group">
                                            <input type="tel" class="form-control" placeholder="Poll a question!">
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="form-group">
                                            <button type="submit" class="btn btn-default">Submit</button>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="d3-body">

</div>

    </body>

<link type='text/css' src="https://raw.githubusercontent.com/daneden/animate.css/master/animate.min.css">
<link type='text/css' src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
<script>
    var margin = {top: 85, right: 40, bottom: 25, left: 40},
            width = Math.max(document.documentElement.clientWidth, window.innerWidth || 0)
                    - margin.left - margin.right,
            height = Math.max(document.documentElement.clientHeight, window.innerHeight || 0)
                    - margin.top - margin.bottom;

    var tip = d3.tip()
            .attr('class', 'd3-tip')
            .offset([-10, 0])
            .html(function(d) {
                var cache = [];
                return '<strong>Data:</strong> <span style="color:#E9F2F9">'
// interesting work around for any circular JSONs
//                    + JSON.stringify(d,
//                        function(key, score) {
//                            if (typeof score === 'object' && score !== null) {
//                                if (cache.indexOf(score) !== -1) {
//                                    // Circular reference found, discard key
//                                    return;
//                                }
//                                // Store score in our collection
//                                cache.push(score);
//                            }
//                            return score;
//                        });
//                cache = [];
                        + ' count: ' + d.count + ' score: ' + d.score
                        + '</span>';
            });
    var zoom = d3.behavior.zoom();
    var active = d3.select(null);
    var svg = d3.select('body').append('svg')
            .attr('width', width + margin.left + margin.right)
            .attr('height', height + margin.top + margin.bottom)
            .append('g')
//        .call(zoom.on("zoom", redraw))
            .attr('transform', 'translate(' + margin.left + ',' + margin.top + ')');
    var JsonData;


    function redraw() {
        var translation = d3.event.translate,
                newx = translation[0],
                newy = translation[1];
        console.log("translate: ", zoom.translate(), "scale:", zoom.scale());
        svg.attr("transform",
                "translate(" + newx + "," + newy + ")"
                + " scale(" + zoom.scale() + ")");
    }

    function manualZoom(){
        var translation = zoom.translate,
                newx = translation[0],
                newy = translation[1];
        svg.attr("transform",
                "translate(" + newx + "," + newy + ")"
                + " scale(" + zoom.scale() + ")");
    }

    // tip hovering
    svg.call(tip);

    // x-axis
    var xScale = d3.scale.linear()
            .domain([-100, 100]) // these are value mappings
            .range([0, width]); // these are pixels
    // y-axis
    var yScale;

    d3.json('data.json', function(error, data){
        if(error){
            console.err('data.json Error: ' + error);
            return;
        }
        JsonData = data;
        var xAxis = d3.svg.axis()
                .scale(xScale)
                .orient('bottom');

        yScale = d3.scale.linear()
                .domain([0, d3.max(data, function(d) { return d.count; })])
                .range([height, 0]);

        //Define Y axis
        var yAxis = d3.svg.axis()
                .scale(yScale)
                .orient('left');

        // X Axis drawing
        svg.append('g')
                .attr('class', 'x axis')
                .attr('transform', 'translate(0,' + height + ')')
                .attr('y', 6)
                .attr('dy', '.71em')
                .style('text-anchor', 'end')
                .text('Score')
                .call(xAxis);

        // Y Axis drawing
        svg.append('g')
                .attr('class', 'y axis')
                .call(yAxis)
                .append('text')
                .attr('transform', 'rotate(-90)')
                .attr('y', 6)
                .attr('dy', '.71em')
                .style('text-anchor', 'end')
                .text('Count');

        // Data Bar
        svg.selectAll('.bar')
                .data(data)
                .enter().append('rect')
                .attr('class', 'bar')
                .attr('class', function(d) {
                    if(d.score < -15){
                        return 'bar negative';
                    }
                    else if(d.score < 15){
                        return 'bar neutral';
                    }
                    else {
                        return 'bar positive';
                    }
                })
                .attr('x', function(d) { return xScale(d.score) - 7; })
                .attr('width', 14)
                .attr('y', function(d) { return yScale(d.count); })
                .attr('height', function(d) { return height - yScale(d.count); })
                .on('mouseover', tip.show)
                .on('mouseout', tip.hide);
    });

    // constant colors for dark gray and selected turquoise
    var DARK_GRAY = '#45484B';
    var SELECTED_COLOR = '#30dbbd';
    var SELECTED_RGB = 'rgb(48, 219, 189)';
    var DARK_RGB = 'rgb(69, 72, 75)';

    // dynamic function to handle bar clicks
    $(document).on('click', '.bar', function () {
        if($(this).css('fill') == SELECTED_RGB){
            // show selected
            $(this).css('fill', '');

            // reset darkened bars
            $('.bar').filter(function() {
                return ( $(this).css('fill') == DARK_RGB );
            }).attr('style', '');
            $('body').attr('style', '');
            return;
        }

        // all become dark gray
        $('.bar').filter(function() {
            return ( $(this).css('fill') != SELECTED_COLOR );
        }).css('fill', DARK_GRAY); // change background color of all black spans
        $('body').css('background-color', 'antiquewhite');
        // selected bar becomes selected color
        $(this).css('fill', SELECTED_COLOR);
    });
</script>
</html>